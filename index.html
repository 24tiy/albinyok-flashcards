<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CSV Flashcards (Q/A)</title>
  <meta name="description" content="–§–ª–µ—à‚Äë–∫–∞—Ä—Ç—ã –∏–∑ CSV: –∫–æ–ª–æ–Ω–∫–∞ A ‚Äî –≤–æ–ø—Ä–æ—Å, B ‚Äî –æ—Ç–≤–µ—Ç. –ù–∞—Ö–æ–¥–∏—Ç –ª—é–±—ã–µ CSV –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (—á–µ—Ä–µ–∑ GitHub Trees API, —É—Å—Ç–æ–π—á–∏–≤–æ –≤ Safari). –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª, –≤—Å—Ç–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤–æ–π." />
  <style>
    :root{ --bg:hsl(220 20% 98%); --bg-alt:hsl(220 30% 96%); --card:#fff; --text:hsl(222 47% 18%); --muted:hsl(222 22% 40%); --accent:hsl(258 90% 66%); --accent-2:hsl(200 90% 60%); --ok:hsl(150 70% 40%); --bad:hsl(0 80% 55%); --shadow:0 10px 30px rgba(20,20,40,.08) }
    @media (prefers-color-scheme: dark){ :root{ --bg:hsl(222 20% 9%); --bg-alt:hsl(222 18% 13%); --card:hsl(222 15% 12%); --text:hsl(0 0% 98%); --muted:hsl(220 10% 70%); --shadow:0 10px 30px rgba(0,0,0,.35) } }
    html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica Neue,Arial; background:radial-gradient(1200px 600px at 10% -20%, var(--bg-alt), transparent 60%), radial-gradient(1200px 600px at 110% 10%, var(--bg-alt), transparent 60%), var(--bg); color:var(--text); line-height:1.45}
    .container{max-width:980px;margin:0 auto;padding:28px 20px 64px}
    header{display:flex;align-items:center;gap:14px;margin-bottom:18px}
    .logo{width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));box-shadow:var(--shadow);display:grid;place-items:center;color:white;font-weight:800}
    h1{font-size:clamp(22px,4vw,30px);margin:0}
    .sub{color:var(--muted);font-size:14px}

    .uploader{margin:22px 0;padding:22px;border:2px dashed rgba(0,0,0,.12);border-radius:20px;background:rgba(0,0,0,.03)}
    @media (prefers-color-scheme: dark){.uploader{border-color:rgba(255,255,255,.18);background:rgba(255,255,255,.03)}}
    .uploader.drag{border-color:var(--accent);background:rgba(139,92,246,.08)}
    .uploader .row{display:flex;flex-wrap:wrap;align-items:center;gap:12px}
    .btn{appearance:none;border:none;background:var(--accent);color:#fff;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer;box-shadow:var(--shadow)}
    .btn.secondary{background:var(--accent-2)}
    .btn.ghost{background:transparent;color:var(--accent);border:1.5px solid var(--accent)}
    input[type=file]{display:none}
    label.file{display:inline-flex;gap:10px;align-items:center;background:var(--card);border:1.5px solid rgba(0,0,0,.08);padding:10px 14px;border-radius:12px;cursor:pointer;box-shadow:var(--shadow)}

    .urlbox{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
    .urlbox input[type=url]{flex:1;min-width:240px;border-radius:12px;border:1.5px solid rgba(0,0,0,.12);padding:10px 12px;background:var(--card);box-shadow:var(--shadow)}

    .picker{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
    select{border-radius:12px;border:1.5px solid rgba(0,0,0,.12);padding:10px 12px;background:var(--card);box-shadow:var(--shadow);min-width:260px}

    .workspace{display:none;margin-top:24px}
    .chip{background:var(--card);border:1px solid rgba(0,0,0,.08);padding:6px 10px;border-radius:999px;box-shadow:var(--shadow);font-size:13px}
    .progress{height:8px;background:rgba(0,0,0,.07);border-radius:999px;overflow:hidden}
    .progress>div{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent-2));width:0%}
    .card{position:relative;background:var(--card);border-radius:24px;box-shadow:var(--shadow);padding:26px;min-height:220px;display:flex;align-items:center;justify-content:center;text-align:center}
    .q{font-size:clamp(18px,2.4vw,22px);font-weight:700}
    .a{font-size:clamp(16px,2.1vw,20px);margin-top:10px;display:none;color:var(--muted)}
    .controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:center;margin-top:16px}
    .ctrl{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1.5px solid rgba(0,0,0,.08);background:var(--card);cursor:pointer;box-shadow:var(--shadow);font-weight:700}
    .ctrl.ok{color:var(--ok)} .ctrl.bad{color:var(--bad)}
    .topbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:10px}
    .tiny{font-size:12px;color:var(--muted)} .kbd{font-family:ui-monospace,Consolas,Menlo,monospace;background:rgba(0,0,0,.08);padding:2px 6px;border-radius:6px}
    .hidden{display:none !important} .error{padding:12px 14px;border-radius:12px;background:rgba(255,0,0,.1);border:1px solid rgba(255,0,0,.25)}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">Q‚ÜîA</div>
      <div>
        <h1>CSV Flashcards</h1>
        <div class="sub">–ê–≤—Ç–æ–ø–æ–∏—Å–∫ CSV —á–µ—Ä–µ–∑ GitHub Trees API + —Ä—É—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞/URL. –§–æ—Ä–º–∞—Ç: A ‚Äî –≤–æ–ø—Ä–æ—Å, B ‚Äî –æ—Ç–≤–µ—Ç.</div>
      </div>
    </header>

    <section class="uploader" id="uploader" aria-label="–ó–∞–≥—Ä—É–∑–∫–∞ CSV">
      <h2>1) –ò—Å—Ç–æ—á–Ω–∏–∫ –∫–∞—Ä—Ç–æ—á–µ–∫</h2>
      <div class="row" style="margin-bottom:12px">
        <label for="file" class="file" id="fileLabel">üìÑ –í—ã–±—Ä–∞—Ç—å CSV‚Äë—Ñ–∞–π–ª</label>
        <input type="file" id="file" accept=".csv,text/csv" />
        <button class="btn secondary" id="templateBtn" type="button">–°–∫–∞—á–∞—Ç—å —à–∞–±–ª–æ–Ω CSV</button>
        <button class="btn ghost" id="demoBtn" type="button">–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ–º–æ‚Äë–Ω–∞–±–æ—Ä</button>
      </div>

      <div class="urlbox">
        <input type="url" id="urlInput" placeholder="https://raw.githubusercontent.com/<owner>/<repo>/main/file.csv" />
        <button class="btn" id="loadUrlBtn" type="button">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ —Å—Å—ã–ª–∫–µ</button>
      </div>

      <div class="picker">
        <select id="csvPicker"><option value="">–ò—â—É CSV –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏‚Ä¶</option></select>
        <button class="btn" id="loadPickedBtn" type="button" disabled>–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π CSV</button>
      </div>

      <div class="tiny">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã URL: <code>?owner=‚Ä¶&repo=‚Ä¶&branch=‚Ä¶&csv=path/in/repo.csv</code>. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é owner/repo –±–µ—Ä—É—Ç—Å—è –∏–∑ –∞–¥—Ä–µ—Å–∞ GitHub Pages, –≤–µ—Ç–∫–∞ ‚Äî <code>main</code>.</div>
      <div id="error" class="error hidden" role="alert"></div>
    </section>

    <section class="workspace" id="workspace" aria-live="polite">
      <div class="topbar">
        <div>
          <span class="chip" id="deckName">–î–µ–∫: ‚Äî</span>
          <span class="chip" id="counter">0 / 0</span>
          <span class="chip" id="score">‚úì 0 ‚Ä¢ ‚úó 0</span>
        </div>
        <div>
          <button class="btn ghost" id="shuffleBtn" title="–ü–µ—Ä–µ–º–µ—à–∞—Ç—å (S)">–ü–µ—Ä–µ–º–µ—à–∞—Ç—å</button>
          <button class="btn ghost" id="resetBtn" title="–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å">–°–±—Ä–æ—Å–∏—Ç—å</button>
          <label class="file" for="reupload">‚Üª –ó–∞–º–µ–Ω–∏—Ç—å CSV</label>
          <input type="file" id="reupload" accept=".csv,text/csv" />
        </div>
      </div>

      <div class="progress" aria-hidden="true"><div id="progressBar"></div></div>

      <div class="card" id="card"><div class="q" id="q">–ó–∞–≥—Ä—É–∑–∏—Ç–µ CSV –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è</div><div class="a" id="a"></div></div>

      <div class="controls" aria-label="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ">
        <button class="ctrl" id="prevBtn" title="–ù–∞–∑–∞–¥ (‚Üê)">‚Üê –ù–∞–∑–∞–¥</button>
        <button class="ctrl" id="revealBtn" title="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –æ—Ç–≤–µ—Ç (–ü—Ä–æ–±–µ–ª/Enter)">–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç</button>
        <button class="ctrl" id="nextBtn" title="–í–ø–µ—Ä—ë–¥ (‚Üí)">–í–ø–µ—Ä—ë–¥ ‚Üí</button>
        <button class="ctrl ok" id="markOkBtn" title="–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –∑–Ω–∞—é (K)">‚úì –ó–Ω–∞—é</button>
        <button class="ctrl bad" id="markBadBtn" title="–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –Ω–µ –∑–Ω–∞—é (J)">‚úó –ù–µ –∑–Ω–∞—é</button>
      </div>
      <div class="tiny" style="text-align:center;margin-top:8px">Space/Enter ‚Äî –æ—Ç–≤–µ—Ç ¬∑ ‚Üê/‚Üí ‚Äî –Ω–∞–≤–∏–≥–∞—Ü–∏—è ¬∑ J/K ‚Äî –Ω–µ –∑–Ω–∞—é/–∑–Ω–∞—é ¬∑ S ‚Äî –ø–µ—Ä–µ–º–µ—à–∞—Ç—å</div>
    </section>
  </div>

  <script>
  const $ = (s)=>document.querySelector(s);
  const $$ = (s)=>Array.from(document.querySelectorAll(s));

  function sniffDelimiter(sample){
    const first = sample.split(/
?
/).slice(0,3).join('
');
    const cand=[',',';','	']; let best=',', n=-1; for(const d of cand){const c=(first.match(new RegExp('\\'+d,'g'))||[]).length; if(c>n){n=c;best=d}} return best;
  }
  function parseCSV(text){
    if(text && text.charCodeAt && text.charCodeAt(0)===0xFEFF) text=text.slice(1);
    const d=sniffDelimiter(text||''); const rows=[]; let i=0,cur='',row=[],q=false;
    while(i<text.length){ const ch=text[i]; if(ch==='"'){ if(q && text[i+1]==='"'){cur+='"'; i+=2; continue;} q=!q; i++; continue; }
      if(!q && (ch==='
'||ch==='
')){ row.push(cur); cur=''; if(row.length) rows.push(row); row=[]; if(ch==='
'&&text[i+1]==='
') i++; i++; continue; }
      if(!q && ch===d){ row.push(cur); cur=''; i++; continue; } cur+=ch; i++; }
    row.push(cur); if(row.length>1 || (row[0]||'').trim()!=='') rows.push(row); return rows;
  }
  function looksLikeHeader([a,b]){ if(!a||!b)return false; const ha=a.trim().toLowerCase(), hb=b.trim().toLowerCase(); return ["q","question","–≤–æ–ø—Ä–æ—Å","–≤–æ–ø—Ä–æ—Å—ã"].includes(ha) && ["a","answer","–æ—Ç–≤–µ—Ç","–æ—Ç–≤–µ—Ç—ã"].includes(hb); }
  function toDeck(rows){ if(!rows||!rows.length) return []; const filtered=rows.map(r=>[r[0]??'',r[1]??'']).filter(r=>(r[0].trim()+r[1].trim())!==''); const s=looksLikeHeader(filtered[0])?1:0; return filtered.slice(s).map(r=>({q:r[0].trim(), a:r[1].trim(), ok:false, bad:false})); }
  function shuffle(a){ for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]} return a; }

  let deck=[], idx=0, shown=false, deckName='‚Äî';
  function updateUI(){ const q=$('#q'), a=$('#a'), c=$('#counter'), s=$('#score'), n=$('#deckName'), bar=$('#progressBar');
    if(!deck.length){ q.textContent='–ó–∞–≥—Ä—É–∑–∏—Ç–µ CSV –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è'; a.textContent=''; a.style.display='none'; c.textContent='0 / 0'; s.textContent='‚úì 0 ‚Ä¢ ‚úó 0'; n.textContent='–î–µ–∫: ‚Äî'; bar.style.width='0%'; return; }
    const card=deck[idx]; q.textContent=card.q||'(–ø—É—Å—Ç–æ–π –≤–æ–ø—Ä–æ—Å)'; a.textContent=card.a||'(–ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç)'; a.style.display=shown?'block':'none'; c.textContent=`${idx+1} / ${deck.length}`; const ok=deck.filter(x=>x.ok).length, bad=deck.filter(x=>x.bad).length; s.textContent=`‚úì ${ok} ‚Ä¢ ‚úó ${bad}`; n.textContent=`–î–µ–∫: ${deckName}`; bar.style.width=`${Math.round(((ok+bad)/Math.max(deck.length,1))*100)}%`; $('#revealBtn').textContent=shown?'–°–∫—Ä—ã—Ç—å –æ—Ç–≤–µ—Ç':'–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç'; }
  function showWorkspace(){ $('#uploader').classList.add('hidden'); $('#workspace').style.display='block'; }
  function showUploader(){ $('#workspace').style.display='none'; $('#uploader').classList.remove('hidden'); }

  function persist(){ try{ localStorage.setItem('csv-flashcards-v4', JSON.stringify({deck,idx,shown,deckName})) }catch{} }
  function restore(){ try{ const raw=localStorage.getItem('csv-flashcards-v4'); if(!raw) return false; const p=JSON.parse(raw); if(Array.isArray(p.deck)&&p.deck.length){ deck=p.deck; idx=Math.min(Math.max(0,p.idx|0),p.deck.length-1); shown=!!p.shown; deckName=p.deckName||'‚Äî'; showWorkspace(); updateUI(); return true; } }catch{} return false; }

  function loadCSVText(text,name='–ú–æ–π –Ω–∞–±–æ—Ä'){ try{ const rows=parseCSV(text||''); const d=toDeck(rows); if(!d.length) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –ø–∞—Ä—ã –≤–æ–ø—Ä–æ—Å/–æ—Ç–≤–µ—Ç (2 –∫–æ–ª–æ–Ω–∫–∏).'); deck=d; idx=0; shown=false; deckName=name; persist(); showWorkspace(); updateUI(); }catch(e){ const err=$('#error'); err.textContent='–û—à–∏–±–∫–∞: '+(e.message||e); err.classList.remove('hidden'); showUploader(); } }
  async function loadFromURL(url){ const res=await fetch(url,{cache:'no-store'}); if(!res.ok) throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ —Å—Å—ã–ª–∫–µ (${res.status})`); const txt=await res.text(); const name=decodeURIComponent(url.split('/').pop()||'–£–¥–∞–ª—ë–Ω–Ω—ã–π CSV'); loadCSVText(txt,name); }

  function guessOwnerRepo(){ const p=new URLSearchParams(location.search); let owner=p.get('owner')||''; let repo=p.get('repo')||''; let branch=p.get('branch')||'main'; try{ const host=location.hostname, parts=location.pathname.split('/').filter(Boolean); if(host.endsWith('github.io')){ owner=owner||host.split('.')[0]; if(parts.length>0) repo=repo||parts[0]; } }catch{} return {owner,repo,branch}; }
  function rawURL(owner,repo,branch,path){ return `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${path}`; }

  async function listCsvViaTrees(owner,repo,branch='main'){ // one request, reliable CORS
    const url=`https://api.github.com/repos/${owner}/${repo}/git/trees/${encodeURIComponent(branch)}?recursive=1`;
    const res=await fetch(url,{headers:{'Accept':'application/vnd.github+json'}});
    if(!res.ok) throw new Error('GitHub Trees API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: '+res.status);
    const data=await res.json();
    const files=(data.tree||[]).filter(it=>it.type==='blob' && /\.csv$/i.test(it.path)).map(it=>({path:it.path,name:it.path.split('/').pop()}));
    return files;
  }

  async function populatePicker(){ const pick=$('#csvPicker'), btn=$('#loadPickedBtn'); const {owner,repo,branch}=guessOwnerRepo(); try{ if(!owner||!repo){ pick.innerHTML='<option>–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å owner/repo ‚Äî —É–∫–∞–∂–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π —Å—Å—ã–ª–∫—É</option>'; btn.disabled=true; return; } const list=await listCsvViaTrees(owner,repo,branch); if(!list.length){ pick.innerHTML='<option>CSV –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</option>'; btn.disabled=true; return; } list.sort((a,b)=>{ if(a.name.toLowerCase()==='data.csv') return -1; if(b.name.toLowerCase()==='data.csv') return 1; return a.path.localeCompare(b.path); }); pick.innerHTML = list.map(f=>`<option value="${f.path}">${f.path}</option>`).join(''); pick.dataset.owner=owner; pick.dataset.repo=repo; pick.dataset.branch=branch; btn.disabled=false; }catch(e){ pick.innerHTML=`<option>–û—à–∏–±–∫–∞ —Å–ø–∏—Å–∫–∞ CSV: ${e.message||e}</option>`; btn.disabled=true; } }

  function handleFile(file){ const r=new FileReader(); r.onload=()=>loadCSVText(String(r.result), file.name.replace(/\.[^.]+$/,'')); r.onerror=()=>alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª'); r.readAsText(file); }

  $('#file').addEventListener('change', e=>{ const f=e.target.files?.[0]; if(f) handleFile(f); });
  $('#reupload').addEventListener('change', e=>{ const f=e.target.files?.[0]; if(f) handleFile(f); });
  const up=$('#uploader'); ['dragenter','dragover'].forEach(ev=> up.addEventListener(ev, e=>{ e.preventDefault(); e.stopPropagation(); up.classList.add('drag'); })); ['dragleave','drop'].forEach(ev=> up.addEventListener(ev, e=>{ e.preventDefault(); e.stopPropagation(); up.classList.remove('drag'); })); up.addEventListener('drop', e=>{ const f=e.dataTransfer?.files?.[0]; if(f) handleFile(f); });

  $('#templateBtn').addEventListener('click', ()=>{ const csv='question,answer
"–°—Ç–æ–ª–∏—Ü–∞ –§—Ä–∞–Ω—Ü–∏–∏?","–ü–∞—Ä–∏–∂"
"2+2?","4"
"–ì–ª–∞–≤–Ω—ã–π —Ü–≤–µ—Ç –Ω–µ–±–∞ –¥–Ω—ë–º","–°–∏–Ω–∏–π"
'; const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='flashcards_template.csv'; a.click(); setTimeout(()=>URL.revokeObjectURL(url),1000); });
  $('#demoBtn').addEventListener('click', ()=>{ const demo=`question,answer
"HTTP —Å—Ç–∞—Ç—É—Å 200","OK ‚Äî —É—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å"
"Git –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è","git clone <url>"
"–ö–æ–ª–æ–Ω–∫–∞ A –≤ CSV","–í–æ–ø—Ä–æ—Å"
"–ö–æ–ª–æ–Ω–∫–∞ B –≤ CSV","–û—Ç–≤–µ—Ç"
`; loadCSVText(demo,'–î–µ–º–æ'); });
  $('#loadUrlBtn').addEventListener('click', async()=>{ const url=($('#urlInput').value||'').trim(); if(!url) return alert('–í—Å—Ç–∞–≤—å —Å—Å—ã–ª–∫—É –Ω–∞ CSV'); try{ await loadFromURL(url); }catch(e){ alert(e.message||e); } });
  $('#loadPickedBtn').addEventListener('click', async()=>{ const pick=$('#csvPicker'); const path=pick.value; if(!path) return; const owner=pick.dataset.owner, repo=pick.dataset.repo, branch=pick.dataset.branch||'main'; const url=rawURL(owner,repo,branch,path); try{ await loadFromURL(url); }catch(e){ alert(e.message||e); } });

  $('#prevBtn').addEventListener('click', ()=>{ if(deck.length){ idx=(idx-1+deck.length)%deck.length; shown=false; updateUI(); persist(); } });
  $('#nextBtn').addEventListener('click', ()=>{ if(deck.length){ idx=(idx+1)%deck.length; shown=false; updateUI(); persist(); } });
  $('#revealBtn').addEventListener('click', ()=>{ shown=!shown; updateUI(); persist(); });
  $('#shuffleBtn').addEventListener('click', ()=>{ if(deck.length){ shuffle(deck); idx=0; shown=false; updateUI(); persist(); } });
  $('#resetBtn').addEventListener('click', ()=>{ deck.forEach(c=>{c.ok=false;c.bad=false}); idx=0; shown=false; updateUI(); persist(); });
  $('#markOkBtn').addEventListener('click', ()=>{ if(deck.length){ deck[idx].ok=true; deck[idx].bad=false; idx=Math.min(idx+1, deck.length-1); shown=false; updateUI(); persist(); } });
  $('#markBadBtn').addEventListener('click', ()=>{ if(deck.length){ deck[idx].bad=true; deck[idx].ok=false; idx=Math.min(idx+1, deck.length-1); shown=false; updateUI(); persist(); } });

  window.addEventListener('keydown', (e)=>{ if(['INPUT','TEXTAREA','SELECT'].includes(document.activeElement?.tagName)) return; if(e.key===' '||e.key==='Enter'){ e.preventDefault(); $('#revealBtn').click(); } else if(e.key==='ArrowRight'){ $('#nextBtn').click(); } else if(e.key==='ArrowLeft'){ $('#prevBtn').click(); } else if(e.key.toLowerCase()==='s'){ $('#shuffleBtn').click(); } else if(e.key.toLowerCase()==='k'){ $('#markOkBtn').click(); } else if(e.key.toLowerCase()==='j'){ $('#markBadBtn').click(); } });
  $('#card').addEventListener('click', ()=>{ shown=!shown; updateUI(); persist(); });

  (async function bootstrap(){ if(restore()) return; const params=new URLSearchParams(location.search); const csv=params.get('csv'); if(csv){ try{ await loadFromURL(csv); return; }catch{} }
    await populatePicker(); const pick=$('#csvPicker'); if(pick && pick.options && pick.options.length && pick.dataset.owner){ const owner=pick.dataset.owner, repo=pick.dataset.repo, branch=pick.dataset.branch||'main'; const path=pick.value; if(path){ try{ await loadFromURL(rawURL(owner,repo,branch,path)); return; }catch{} } }
  })();

  $$('.btn, .ctrl, label.file').forEach(el=>{ el.addEventListener('keydown', e=>{ if(e.key===' '||e.key==='Enter'){ e.preventDefault(); el.click(); } }); });
  $('#fileLabel').addEventListener('click', ()=> $('#file').click());
  </script>
</body>
</html>
